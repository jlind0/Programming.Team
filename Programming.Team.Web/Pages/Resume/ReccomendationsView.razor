@page "/resume/recommendations"
@attribute [Authorize]
@inherits ReactiveInjectableComponentBase<ReccomendationsViewModel>

<MudContainer Class="d-flex flex-column align-center pt-6 color-under-paper">
@if (ViewModel != null)
{
    <AlertView Alert="ViewModel.Alert" />
    <MudButton OnClick="ViewModel.StartAdd.BindCommand<MouseEventArgs>()" Class="fw-bold" Variant="Variant.Filled"
        Color="Color.Primary">Add Reccomendation</MudButton>
    <AddReccomendationView ViewModel="ViewModel.AddViewModel" />
    @foreach (var position in ViewModel.Entities)
    {
        <MudPaper
            Class="pa-4 mb-4"
            Style="max-width: 42rem; height: auto;">        
            <ReccomendationView ViewModel="position" />
        </MudPaper>
    }
}
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        if (ViewModel != null)
            ViewModel.Entities.CollectionChanged += (s, e) =>
            {
                InvokeAsync(StateHasChanged);
            };
        base.OnInitialized();
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (ViewModel != null && firstRender)
        {
            await ViewModel.Load.Execute().GetAwaiter();

        }
        await base.OnAfterRenderAsync(firstRender);
    }
}
